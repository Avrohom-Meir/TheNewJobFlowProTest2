{"version":3,"sources":["../src/schema.ts"],"sourcesContent":["import { pgTable, serial, text, timestamp, integer, jsonb } from 'drizzle-orm/pg-core'\n\nexport const tenants = pgTable('tenants', {\n  id: serial('id').primaryKey(),\n  name: text('name').notNull(),\n  subdomain: text('subdomain').notNull().unique(),\n  status: text('status').notNull(), // Provisioning/Active/Suspended\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  plan: text('plan').notNull(),\n  currentSchemaVersion: integer('current_schema_version').default(1).notNull(),\n})\n\nexport const tenantDatabases = pgTable('tenant_databases', {\n  tenantId: integer('tenant_id').references(() => tenants.id).primaryKey(),\n  neonDbIdentifier: text('neon_db_identifier').notNull(),\n  connectionSecretRef: text('connection_secret_ref'), // or encrypted\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n})\n\nexport const subscriptions = pgTable('subscriptions', {\n  tenantId: integer('tenant_id').references(() => tenants.id).primaryKey(),\n  provider: text('provider').notNull(),\n  plan: text('plan').notNull(),\n  status: text('status').notNull(),\n  renewalDate: timestamp('renewal_date'),\n  providerIds: jsonb('provider_ids'), // json\n})\n\nexport const masterUsers = pgTable('master_users', {\n  id: serial('id').primaryKey(),\n  email: text('email').notNull().unique(),\n  hashedPassword: text('hashed_password'), // or external auth id\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  lastLoginAt: timestamp('last_login_at'),\n})\n\nexport const userTenantRoles = pgTable('user_tenant_roles', {\n  masterUserId: integer('master_user_id').references(() => masterUsers.id),\n  tenantId: integer('tenant_id').references(() => tenants.id),\n  role: text('role').notNull(), // OwnerAdmin, TenantAdmin, Sales, Worker, Finance\n}, (table) => ({\n  pk: [table.masterUserId, table.tenantId],\n}))\n\nexport const provisioningJobs = pgTable('provisioning_jobs', {\n  tenantId: integer('tenant_id').references(() => tenants.id).primaryKey(),\n  stage: text('stage').notNull(),\n  status: text('status').notNull(),\n  error: text('error'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n})\n\nexport const migrationRuns = pgTable('migration_runs', {\n  id: serial('id').primaryKey(),\n  tenantId: integer('tenant_id').references(() => tenants.id),\n  targetVersion: integer('target_version').notNull(),\n  startedAt: timestamp('started_at').defaultNow().notNull(),\n  finishedAt: timestamp('finished_at'),\n  status: text('status').notNull(),\n  errorMessage: text('error_message'),\n})\n\nexport const auditLog = pgTable('audit_log', {\n  id: serial('id').primaryKey(),\n  actor: text('actor').notNull(),\n  action: text('action').notNull(),\n  timestamp: timestamp('timestamp').defaultNow().notNull(),\n  tenantId: integer('tenant_id').references(() => tenants.id),\n  metadata: jsonb('metadata'),\n})"],"mappings":"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","names":[]}